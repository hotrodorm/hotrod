<?xml version="1.0"?>
<!DOCTYPE hotrod-fragment SYSTEM "hotrod-fragment.dtd">

<hotrod-fragment>

  <facet name="visits-dev">

    <table name="visit" />

  </facet>

  <table name="purchase">
    <auto-generated-column name="id" />
  </table>

  <dao java-class-name="GeneralOperations">

    <!-- Native SQL - Insert Special Column Type (ARRAY) -->
    <query java-method-name="insertPreferredColors">

      <parameter name="id" java-type="java.lang.Integer" jdbc-type="NUMERIC" />
      <parameter name="color1" java-type="java.lang.String" jdbc-type="VARCHAR" />
      <parameter name="color2" java-type="java.lang.String" jdbc-type="VARCHAR" />
      <parameter name="color3" java-type="java.lang.String" jdbc-type="VARCHAR" />

      insert into preferred_colors (id, colors) values (
        #{id},
        ( #{color1}, #{color2}, #{color3} )
      )

    </query>

    <!-- Dynamic SQL - Update Unsold Vehicles -->
    <query java-method-name="applyDiscountToVehicles">

      <parameter name="discount" java-type="java.lang.Integer" jdbc-type="NUMERIC" />
      <parameter name="unsold" java-type="java.lang.Boolean" jdbc-type="BOOLEAN" />
      <parameter name="minMileage" java-type="java.lang.Integer" jdbc-type="NUMERIC" />
      <parameter name="type" java-type="java.lang.String" jdbc-type="VARCHAR" />

      update vehicle set
          list_price = list_price - #{discount}
        <where>
          <if test="unsold != null">
            and not sold
          </if>
          <if test="minMileage != null">
            and mileage > #{minMileage}
          </if>
          <if test="type != null">
            and type = #{type}
          </if>
        </where>

    </query>

  </dao>

</hotrod-fragment>
