<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title></title>
<link rel="stylesheet" href="styles/lightweight.css">

<script src="jquery/jquery-3.1.1.min.js"></script>

<link rel="stylesheet" href="highlight/styles/vs.css">
<script src="highlight/highlight.pack.js"></script>
<script>
  $(document).ready(function() {
    $('pre').each(function(i, block) {
      hljs.highlightBlock(block);
    });
  });
</script>

</head>
<body>

  <table>
    <tr>
      <td><img src="images/hotrod-logo-70.png"
        style="display: inline;" /></td>
      <td>
        <p style="font-size: 30px; margin: 0; padding-left: 15px;">Advanced
          Database Persistence for Java</p>
        <p style="font-size: 18px; margin: 0; padding-left: 15px;">Examples
          &amp; Reference Manual</p>
      </td>
    </tr>
  </table>

  <div
    style="width: 100%; border-bottom: 2px solid #c0c0c0; font-size: 6px;">&nbsp;</div>

  <div>

    <ul class="menu">
      <li><a href="01-welcome-to-hotrod.html">Welcome to
          HotRod!</a></li>
      <li><a href="02-apache-2.0-license.html">Apache 2.0
          License</a></li>
      <li><a href="03-downloads.html">Downloads</a></li>
      <li><a href="04-hello-world-mybatis.html">Hello World MyBatis!</a></li>
      <li><a href="05-source-code.html">Source Code</a></li>
      <li><a href="06.1-ant-task.html">Ant Task</a></li>
      <li><a href="06.2-development-acceleration.html">Development Acceleration Using Hotrod</a></li>
      <li><a href="07.01-mybatis-generator.html">MyBatis Generator</a></li>
      <li class="menu2"><a href="07.02-mybatis-cheat-sheet.html">MyBatis Cheat Sheet</a></li>
      <li class="menu2"><a href="07.03-how-to-run-the-examples.html">How to Run the Examples</a></li>
      <li class="menu2"><a href="07.04-example01.html">Example 1 - Basic CRUD
          Operations on Tables</a></li>
      <li class="menu2"><a href="07.04-example02.html">Example 2 - Using
          Sequences &amp; Identity PKs</a></li>
      <li class="menu2"><a href="07.04-example03.html">Example 3 - Select by
          Example</a></li>
      <li class="menu2"><a href="07.04-example04.html">Example 4 - Update by
          Example</a></li>
      <li class="menu2"><a href="07.04-example05.html">Example 5 - Delete by
          Example</a></li>
      <li class="menu2"><a href="07.04-example06.html">Example 6 - Navigating
          Foreign Keys</a></li>
      <li class="menu2"><a href="07.04-example07.html">Example 7 - Select by
          Unique Indexes</a></li>
      <li class="menu2"><a href="07.04-example08.html">Example 8 - Selecting
          on Views</a></li>
      <li class="menu2"><a href="07.04-example09.html">Example 9 - Retrieving
          Sequence Values</a></li>
      <li class="menu2"><a href="07.04-example10.html">Example 10 - Regular
          SQL Queries</a></li>
      <li class="menu2"><a href="07.04-example11.html">Example 11 - Custom
          DAOs</a></li>
      <li class="menu2"><a href="07.04-example12.html">Example 12 - Regular
          SQL Selects</a></li>
      <li class="menu2"><a href="07.04-example13.html">Example 13 - Native SQL</a></li>
      <li class="menu2"><a href="07.04-example14.html">Example 14 - Dynamic
          SQL</a></li>
      <li class="menu2"><a href="07.04-example15.html">Example 15 -
          Transactions &amp; Isolation Levels</a></li>
      <li class="menu2"><a href="07.04-example16.html">Example 16 - Optimistic
          Locking (Row Version Control)</a></li>
      <li class="menu2"><a href="07.04-example17.html">Example 17 - Custom DAO
          Class Names</a></li>
      <li class="menu2"><a href="07.04-example18.html">Example 18 - Custom DAO
          Property Names</a></li>
      <li class="menu2"><a href="07.04-example19.html">Example 19 - Custom DAO
          Property Java Types</a></li>
      <li class="menu2"><a href="07.04-example20.html">Example 20 - Fragments</a></li>
      <li class="menu2"><a href="07.04-example21.html">Example 21 - Facets</a></li>
      <li class="menu2"><a href="07.04-example22.html">Example 22 - Including
          Existing MyBatis Mappers</a></li>
      <li><a href="09-project-setup.html">Project Setup</a></li>
      <li><a href="10-database-support.html">Supported Databases &amp; Column Types</a></li>
      <li class="menu2"><a href="10.01-oracle.html">Oracle Database</a></li>
      <li class="menu2"><a href="10.02-db2.html">IBM DB2</a></li>
      <li class="menu2"><a href="10.03-sapase.html">SAP ASE / Sybase</a></li>
      <li class="menu2"><a href="10.04-sqlserver.html">Microsoft SQL Server</a></li>
      <li class="menu2"><a href="10.05-postgresql.html">PostgreSQL</a></li>
      <li class="menu2"><a href="10.06-mysql.html">MySQL</a></li>
      <li class="menu2"><a href="10.07-mariadb.html">MariaDB</a></li>
      <li class="menu2"><a href="10.08-hypersql.html">HyperSQL (HSQLDB)</a></li>
      <li class="menu2"><a href="10.09-h2.html">H2</a></li>
      <li><a href="11.01-configuration-reference.html">Configuration Reference</a></li>
      <li class="menu2"><a href="11.02-mybatis-generator.html">MyBatis Generator</a></li>
      <li class="menu2"><a href="11.04-tables.html">Tables</a></li>
      <li class="menu2"><a href="11.05-columns.html">Columns</a></li>
      <li class="menu2"><a href="11.06-sequences.html">Sequences</a></li>
      <li class="menu2"><a href="11.07-sql-queries.html">SQL Queries</a></li>
      <li class="menu2"><a href="11.08-views.html">Views</a></li>
      <li class="menu2"><a href="11.09-sql-selects.html">SQL Selects</a></li>
      <li class="menu2"><a href="11.10-dynamic-sql.html">Dynamic SQL</a></li>
      <li class="menu2"><a href="11.11-custom-daos.html">Custom DAOs </a></li>
      <li class="menu2"><a href="11.12-fragments.html">Fragments</a></li>
      <li class="menu2"><a class="active" href="11.13-facets.html">Facets</a></li>
      <li class="menu2"><a href="11.14-existing-mybatis-mappers.html">Existing MyBatis
          Mappers</a></li>
      <li><a href="12-faq.html">FAQ</a></li>
    </ul>

    <div class="article">

      <!-- ============= -->
      <!-- Article Begin -->
      <!-- ============= -->

<h1>Facets</h1>

<p>Facets allow the developer to produce partial code re-generation.</p>

<p>When the project is small&mdash;containing a few tables and views&mdash;it doesn&#39;t make much of a difference to generate all the DAOs of the whole project every time a configuration change is added.</p>

<p>However, when the project grows&mdash;specially when the configuration includes expensive DAOs&mdash;it can be much faster to re-generate only the specific section that changes instead of the full list of DAOs.</p>

<p>It&#39;s recommended that a full re-generation is done periodically, nevertheless (maybe once a day), to avoid cases where a new configuration change fell through the crack and was never regenerated by mistake. One member of the team can be in charge of this, or even a continuous integration server can be set up to do this every night.</p>

<h2>Regeneration Slowness</h2>

<p>The need to generate only a subset of database objects is based on the need to keep the development speed up and agile. You want to keep you development speed high, don&#39;t you? According to our experience it turns out there are three main issues that slow down the HotRod re-generation.</p>

<h3>Great Number of DAOs</h3>

<p>One main unavoidable source of slowness, is that some databases are slow to provide database objects metadata. The JDBC metadata interface is an optional part of the JDBC drivers&#39; implementation, and is somewhat disregarded by the database vendors. On some database the metadata extraction is fast and efficient, but in other ones is... well it leaves room for improvement.</p>

<p>If your project has massive number of tables, views, and selects, then the HotRod generation can become slow simply because the database takes minutes to respond instead of (milli)seconds.</p>

<h3>Expensive DAOs</h3>

<p>Another source of slowness, can be the complexity of the <code>&lt;select&gt;</code> tags defined in the configuration file. Some databases are slow to create and drop complex views. This is particularly important when your project has massive number of <code>&lt;select&gt;</code> statements. If this is the case, every entire code generation will refresh these SQL select statements by creating and dropping complex views on the database.</p>

<h3>Slow Database</h3>

<p>Sometimes you are just unlucky with the database server. Maybe it&#39;s overwhelmed. Maybe it&#39;s a small machine. Maybe the network connection is slow, specially if you need to connect to it over a VPN or network tunnel. Usually there&#39;s not much you can do about it.</p>

<p>In the end, it doesn&#39;t really matter why the code generation becomes slow. The important thing here is that generating small subsets of the persistence layer instead of its entirety becomes much more efficient. And this is exactly what facets do.</p>

<h2>Multiple Facets</h2>

<p>When generation the persistence layer the developer can specify one or more facets to be generated. This way facets may be additionally subdivided to suit different development needs.</p>

<p>On the other hand, if no facet is specified, then HotRod generates the whole configuration file.</p>

<h2>Facets are Merged</h2>

<p>Facets act more like a mark on the configuration tag than as a section of it. That is the same facet may show up multiple times in the configuration file or any of its included fragments. All the facet tags are combined into a single one that performs the partial code generation.</p>

<h2>Example</h2>

<p>The facets selection is not part of the configuration file but it&#39;s specified when running HotRod. The configuration file defines the facets, and it&#39;s the HotRod execution that chooses the ones to be generated.</p>

<p>The excerpt below, obtained from the Ant target that executes HotRod shows how to decide which facets are to be generated:</p>

<pre class="xml">  &lt;hotrod driverclass="..."
          url="..."
          username="..."
          password="..."
          catalog="..."
          schema="..."
          generator="..."
          facets="employee, version-5.1"
          configfile="..."
          display="..." /></pre>

<p>The list of selected facets is separated by commas. If no facet is specified&mdash;either by an absent facet attribute or because its value is blank or empty&mdash;then the whole configuration is included and generated.</p>

<p>The example shown below includes a configuration file that includes another fragment. The main configuration file is:</p>

<pre class="xml">&lt;?xml version="1.0"?>
&lt;!DOCTYPE hotrod SYSTEM "hotrod.dtd">

&lt;hotrod>

  &lt;generators>
    &lt;mybatis>
      ...
    &lt;/mybatis>
  &lt;/generators>

  &lt;facet name="employee">
    &lt;table name="employee" />
  &lt;/facet>

  &lt;table name="branch" />
  
  &lt;fragment file="accounting/purchases.xml" />

  &lt;facet name="employee">
    &lt;view name="department" />
 
    &lt;select java-class-name="ExecutiveEmployee">
    &lt;![CDATA[
      select * from employee where is_executive = 1
    ]]>
    &lt;/select>
  &lt;/facet>

&lt;/hotrod></pre>

<p>The included <code>purchases.xml</code> fragment file is:</p>

<pre class="xml">&lt;?xml version="1.0"?>
&lt;!DOCTYPE hotrod-fragment SYSTEM "hotrod-fragment.dtd">

&lt;hotrod-fragment>

  &lt;facet name="orders-management">

    &lt;table name="order" />

    &lt;select java-class-name="ExpensiveOrder">
    &lt;![CDATA[
      select * from order where price &gt; 1000.00
    ]]>
    &lt;/select>

  &lt;/facet>

  &lt;table name="gift_card" />

  &lt;select java-class-name="MonthlyCoupon">
  &lt;![CDATA[
    select * from coupon where type = 'MONTHLY'
  ]]>
  &lt;/select>

  &lt;facet name="employee">
    &lt;table name="employee_order" />
  &lt;/facet>

&lt;/hotrod></pre>

<p>These two fragments define several tables and three SQL selects. There are a few things to notice here:</p>

<ul>
  <li>There are two facets: <code>employee</code>, and <code>order-management</code>.</li>
  <li>One facet (<code>employee</code>) shows up multiple times in the same file (the main configuration file), the other one (<code>order-management</code>) shows up in a single file (<code>purchases.xml</code>).</li>
  <li>One facet (<code>employee</code>) shows up in multiple files. It shows up in both of them.</li>
  <li>Some tables and SQL selects do not belong to any facet: table <code>branch</code>, and select <code>MonthlyCoupon</code>. These are only generated when the whole configuration is selected, i.e. no facets are specified.</li>
</ul>

<p>Essentially you can specify the facets in any combination needed by the development team. It&#39;s the HotRod execution that selects which ones to use.</p>

<p>&nbsp;</p>


      <!-- =========== -->
      <!-- Article End -->
      <!-- =========== -->

    </div>

  </div>

</body>
</html>