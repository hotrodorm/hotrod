<h1>Facets</h1>

<p>Facets allow the developer to produce partial code re-generation.</p>

<p>When the project is small&mdash;containing a few tables and
  views&mdash;it doesn&#39;t make much of a difference to generate all
  the DAOs of the whole project every time a configuration change is
  added.</p>

<p>However, when the project grows&mdash;specially when the
  configuration includes expensive DAOs&mdash;it can be much faster to
  re-generate only the specific section that changes instead of the full
  list of DAOs.</p>

<p>It&#39;s recommended that a full re-generation is done
  periodically, nevertheless (maybe once a day), to avoid cases where a
  new configuration change fell through the crack and was never
  regenerated by mistake. One member of the team can be in charge of
  this, or even a continuous integration server can be set up to do this
  every night.</p>

<h2>Regeneration Slowness</h2>

<p>The need to generate only a subset of database objects is based
  on the need to keep the development speed up and agile. You want to
  keep you development speed high, don&#39;t you? According to our
  experience it turns out there are three main issues that slow down the
  HotRod re-generation.</p>

<h3>Great Number of DAOs</h3>

<p>One main unavoidable source of slowness, is that some databases
  are slow to provide database objects metadata. The JDBC metadata
  interface is an optional part of the JDBC drivers&#39; implementation,
  and is somewhat disregarded by the database vendors. On some database
  the metadata extraction is fast and efficient, but in other ones is...
  well it leaves room for improvement.</p>

<p>If your project has massive number of tables, views, and selects,
  then the HotRod generation can become slow simply because the database
  takes minutes to respond instead of (milli)seconds.</p>

<h3>Expensive DAOs</h3>

<p>
  Another source of slowness, can be the complexity of the
  <code>&lt;select&gt;</code>
  tags defined in the configuration file. Some databases are slow to
  create and drop complex views. This is particularly important when
  your project has massive number of
  <code>&lt;select&gt;</code>
  statements. If this is the case, every entire code generation will
  refresh these SQL select statements by creating and dropping complex
  views on the database.
</p>

<h3>Slow Database</h3>

<p>Sometimes you are just unlucky with the database server. Maybe
  it&#39;s overwhelmed. Maybe it&#39;s a small machine. Maybe the
  network connection is slow, specially if you need to connect to it
  over a VPN or network tunnel. Usually there&#39;s not much you can do
  about it.</p>

<p>In the end, it doesn&#39;t really matter why the code generation
  becomes slow. The important thing here is that generating small
  subsets of the persistence layer instead of its entirety becomes much
  more efficient. And this is exactly what facets do.</p>

<h2>Multiple Facets</h2>

<p>When generation the persistence layer the developer can specify
  one or more facets to be generated. This way facets may be
  additionally subdivided to suit different development needs.</p>

<p>On the other hand, if no facet is specified, then HotRod
  generates the whole configuration file.</p>

<h2>Facets are Merged</h2>

<p>Facets act more like a mark on the configuration tag than as a
  section of it. That is the same facet may show up multiple times in
  the configuration file or any of its included fragments. All the facet
  tags are combined into a single one that performs the partial code
  generation.</p>

<h2>Example</h2>

<p>The facets selection is not part of the configuration file but
  it&#39;s specified when running HotRod. The configuration file defines
  the facets, and it&#39;s the HotRod execution that chooses the ones to
  be generated.</p>

<p>The excerpt below, obtained from the Ant target that executes
  HotRod shows how to decide which facets are to be generated:</p>

<pre class="xml">  &lt;hotrod driverclass="..."
          url="..."
          username="..."
          password="..."
          catalog="..."
          schema="..."
          generator="..."
          facets="employee, version-5.1"
          configfile="..."
          display="..." /></pre>

<p>The list of selected facets is separated by commas. If no facet
  is specified&mdash;either by an absent facet attribute or because its
  value is blank or empty&mdash;then the whole configuration is included
  and generated.</p>

<p>The example shown below includes a configuration file that
  includes another fragment. The main configuration file is:</p>

<pre class="xml">&lt;?xml version="1.0"?>
&lt;!DOCTYPE hotrod SYSTEM "hotrod.dtd">

&lt;hotrod>

  &lt;generators>
    &lt;mybatis>
      ...
    &lt;/mybatis>
  &lt;/generators>

  &lt;facet name="employee">
    &lt;table name="employee" />
  &lt;/facet>

  &lt;table name="branch" />
  
  &lt;fragment file="accounting/purchases.xml" />

  &lt;facet name="employee">
    &lt;view name="department" />
 
    &lt;select java-class-name="ExecutiveEmployee">
    &lt;![CDATA[
      select * from employee where is_executive = 1
    ]]>
    &lt;/select>
  &lt;/facet>

&lt;/hotrod></pre>

<p>
  The included
  <code>purchases.xml</code>
  fragment file is:
</p>

<pre class="xml">&lt;?xml version="1.0"?>
&lt;!DOCTYPE hotrod-fragment SYSTEM "hotrod-fragment.dtd">

&lt;hotrod-fragment>

  &lt;facet name="orders-management">

    &lt;table name="order" />

    &lt;select java-class-name="ExpensiveOrder">
    &lt;![CDATA[
      select * from order where price &gt; 1000.00
    ]]>
    &lt;/select>

  &lt;/facet>

  &lt;table name="gift_card" />

  &lt;select java-class-name="MonthlyCoupon">
  &lt;![CDATA[
    select * from coupon where type = 'MONTHLY'
  ]]>
  &lt;/select>

  &lt;facet name="employee">
    &lt;table name="employee_order" />
  &lt;/facet>

&lt;/hotrod></pre>

<p>These two fragments define several tables and three SQL selects.
  There are a few things to notice here:</p>

<ul>
  <li>There are two facets: <code>employee</code>, and <code>order-management</code>.
  </li>
  <li>One facet (<code>employee</code>) shows up multiple times in
    the same file (the main configuration file), the other one (<code>order-management</code>)
    shows up in a single file (<code>purchases.xml</code>).
  </li>
  <li>One facet (<code>employee</code>) shows up in multiple files.
    It shows up in both of them.
  </li>
  <li>Some tables and SQL selects do not belong to any facet: table
    <code>branch</code>, and select <code>MonthlyCoupon</code>. These
    are only generated when the whole configuration is selected, i.e. no
    facets are specified.
  </li>
</ul>

<p>Essentially you can specify the facets in any combination needed
  by the development team. It&#39;s the HotRod execution that selects
  which ones to use.</p>

<p>&nbsp;</p>

