<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title></title>
<link rel="stylesheet" href="styles/lightweight.css">

<script src="jquery/jquery-3.1.1.min.js"></script>

<link rel="stylesheet" href="highlight/styles/vs.css">
<script src="highlight/highlight.pack.js"></script>
<script>
  $(document).ready(function() {
    $('pre').each(function(i, block) {
      hljs.highlightBlock(block);
    });
  });
</script>

</head>
<body>

  <table>
    <tr>
      <td><img src="images/hotrod-logo-70.png"
        style="display: inline;" /></td>
      <td>
        <p style="font-size: 30px; margin: 0; padding-left: 15px;">Advanced
          Database Persistence for Java</p>
        <p style="font-size: 18px; margin: 0; padding-left: 15px;">Examples
          &amp; Reference Manual</p>
      </td>
    </tr>
  </table>

  <div
    style="width: 100%; border-bottom: 2px solid #c0c0c0; font-size: 6px;">&nbsp;</div>

  <div>

    <ul class="menu">
      <li><a href="01-welcome-to-hotrod.html">Welcome to
          HotRod!</a></li>
      <li><a href="02-apache-2.0-license.html">Apache 2.0
          License</a></li>
      <li><a href="03-downloads.html">Downloads</a></li>
      <li><a href="04-hello-world-mybatis.html">Hello World MyBatis!</a></li>
      <li><a href="05-source-code.html">Source Code</a></li>
      <li><a href="06.1-ant-task.html">Ant Task</a></li>
      <li><a href="06.2-development-acceleration.html">Development Acceleration Using Hotrod</a></li>
      <li><a href="07.01-mybatis-generator.html">MyBatis Generator</a></li>
      <li class="menu2"><a href="07.02-mybatis-cheat-sheet.html">MyBatis Cheat Sheet</a></li>
      <li class="menu2"><a href="07.03-how-to-run-the-examples.html">How to Run the Examples</a></li>
      <li class="menu2"><a href="07.04-example01.html">Example 1 - Basic CRUD
          Operations on Tables</a></li>
      <li class="menu2"><a href="07.04-example02.html">Example 2 - Using
          Sequences &amp; Identity PKs</a></li>
      <li class="menu2"><a href="07.04-example03.html">Example 3 - Select by
          Example</a></li>
      <li class="menu2"><a href="07.04-example04.html">Example 4 - Update by
          Example</a></li>
      <li class="menu2"><a href="07.04-example05.html">Example 5 - Delete by
          Example</a></li>
      <li class="menu2"><a href="07.04-example06.html">Example 6 - Navigating
          Foreign Keys</a></li>
      <li class="menu2"><a href="07.04-example07.html">Example 7 - Select by
          Unique Indexes</a></li>
      <li class="menu2"><a href="07.04-example08.html">Example 8 - Selecting
          on Views</a></li>
      <li class="menu2"><a href="07.04-example09.html">Example 9 - Retrieving
          Sequence Values</a></li>
      <li class="menu2"><a href="07.04-example10.html">Example 10 - Regular
          SQL Queries</a></li>
      <li class="menu2"><a href="07.04-example11.html">Example 11 - Custom
          DAOs</a></li>
      <li class="menu2"><a href="07.04-example12.html">Example 12 - Regular
          SQL Selects</a></li>
      <li class="menu2"><a href="07.04-example13.html">Example 13 - Native SQL</a></li>
      <li class="menu2"><a href="07.04-example14.html">Example 14 - Dynamic
          SQL</a></li>
      <li class="menu2"><a href="07.04-example15.html">Example 15 -
          Transactions &amp; Isolation Levels</a></li>
      <li class="menu2"><a href="07.04-example16.html">Example 16 - Optimistic
          Locking (Row Version Control)</a></li>
      <li class="menu2"><a href="07.04-example17.html">Example 17 - Custom DAO
          Class Names</a></li>
      <li class="menu2"><a href="07.04-example18.html">Example 18 - Custom DAO
          Property Names</a></li>
      <li class="menu2"><a href="07.04-example19.html">Example 19 - Custom DAO
          Property Java Types</a></li>
      <li class="menu2"><a href="07.04-example20.html">Example 20 - Fragments</a></li>
      <li class="menu2"><a href="07.04-example21.html">Example 21 - Facets</a></li>
      <li class="menu2"><a href="07.04-example22.html">Example 22 - Including
          Existing MyBatis Mappers</a></li>
      <li><a href="09-project-setup.html">Project Setup</a></li>
      <li><a href="10-database-support.html">Supported Databases &amp; Column Types</a></li>
      <li class="menu2"><a href="10.01-oracle.html">Oracle Database</a></li>
      <li class="menu2"><a href="10.02-db2.html">IBM DB2</a></li>
      <li class="menu2"><a href="10.03-sapase.html">SAP ASE / Sybase</a></li>
      <li class="menu2"><a href="10.04-sqlserver.html">Microsoft SQL Server</a></li>
      <li class="menu2"><a href="10.05-postgresql.html">PostgreSQL</a></li>
      <li class="menu2"><a href="10.06-mysql.html">MySQL</a></li>
      <li class="menu2"><a href="10.07-mariadb.html">MariaDB</a></li>
      <li class="menu2"><a href="10.08-hypersql.html">HyperSQL (HSQLDB)</a></li>
      <li class="menu2"><a href="10.09-h2.html">H2</a></li>
      <li><a href="11.01-configuration-reference.html">Configuration Reference</a></li>
      <li class="menu2"><a href="11.02-mybatis-generator.html">MyBatis Generator</a></li>
      <li class="menu2"><a href="11.04-tables.html">Tables</a></li>
      <li class="menu2"><a href="11.05-columns.html">Columns</a></li>
      <li class="menu2"><a href="11.06-sequences.html">Sequences</a></li>
      <li class="menu2"><a href="11.07-sql-queries.html">SQL Queries</a></li>
      <li class="menu2"><a href="11.08-views.html">Views</a></li>
      <li class="menu2"><a href="11.09-sql-selects.html">SQL Selects</a></li>
      <li class="menu2"><a class="active" href="11.10-dynamic-sql.html">Dynamic SQL</a></li>
      <li class="menu2"><a href="11.11-custom-daos.html">Custom DAOs </a></li>
      <li class="menu2"><a href="11.12-fragments.html">Fragments</a></li>
      <li class="menu2"><a href="11.13-facets.html">Facets</a></li>
      <li class="menu2"><a href="11.14-existing-mybatis-mappers.html">Existing MyBatis
          Mappers</a></li>
      <li><a href="12-faq.html">FAQ</a></li>
    </ul>

    <div class="article">

      <!-- ============= -->
      <!-- Article Begin -->
      <!-- ============= -->


<h1>Dynamic SQL</h1>

<p>When using MyBatis, HotRod leverages the MyBatis dynamic SQL capabilities to execute SQL statements that include or exclude fragments of SQL at runtime based on the parameter values provided by the application on each execution.</p>

<p>While&mdash;accurately described on the MyBatis manual&mdash;&ldquo;working with Dynamic SQL will never be a party&rdquo;, the dynamic SQL strategy reduces considerably the amount of work the developer needs to do when writing heavily parameterized SQL.</p>

<p>The example and description shown in this section uses a SQL <code>&lt;query&gt;</code> tag. However, all this functionality is valid as well for the <code>&lt;select&gt;</code> tags</p>

<p>For details on the MyBatis dynamic syntax for SQL statements please see the MyBatis documentation. The one-sentence description is that MyBatis enhances the SQL definitions by allowing <code>&lt;if&gt;</code>, <code>&lt;choose&gt;</code>, <code>&lt;when&gt;</code>, <code>&lt;otherwise&gt;</code>, <code>&lt;trim&gt;</code>, <code>&lt;where&gt;</code>, <code>&lt;set&gt;</code>, and <code>&lt;foreach&gt;</code> tags to be added to it to transform and reshape the SQL sentence at runtime.</p>

<p>The example below shows a SQL update whose structure changes dynamically:</p>

<pre class="xml">    &lt;query java-method-name="addFreebiesToOrders">
    &lt;![CDATA[
      update purchase_order
        &lt;set>
          &lt;if test="#{discount,javaType=java.lang.Double,jdbcType=NUMERIC} != null">
            discount = #{discount}
          ,&lt;/if>
          &lt;if test="#{extraQuantity,javaType=java.lang.Long,jdbcType=NUMERIC} != null">
            quantity = quantity + #{extraQuantity}
          ,&lt;/if>
          &lt;if test="#{shippingType,javaType=java.lang.Integer,jdbcType=NUMERIC} != null">
            shipping_type = #{shippingType}
          ,&lt;/if>
          &lt;if test="#{freeWarranty,javaType=java.lang.Integer,jdbcType=NUMERIC} != null">
            free_warranty = #{freeWarranty}
          ,&lt;/if>
        &lt;/set>
        &lt;where>
          &lt;if test="#{widgetType,javaType=java.lang.Integer,jdbcType=NUMERIC} != null">
            widget_type = #{widgetType}
          &lt;/if>
          &lt;if test="#{zipCode,javaType=java.lang.String,jdbcType=VARCHAR} != null">
            AND zip_code = #{zipCode}
          &lt;/if>
          &lt;if test="#{orderDate,javaType=java.sql.Date,jdbcType=DATE} != null">
            AND order_date &lt; #{orderDate}
          &lt;/if>
        &lt;/where>
    ]]>
    &lt;/query></pre>

<p>This tag produces the static DAO java method:</p>

<pre class="java">  public static int addFreebiesToOrders(
    java.lang.Double discount,
    java.lang.Long extraQuantity,
    java.lang.Integer shippingType,
    java.lang.Integer freeWarranty,
    java.lang.Integer widgetType,
    java.lang.String zipCode,
    java.sql.Date orderDate) { ... }</pre>

<p>In the example above, depending on which parameters are null or not, one or more freebies (a discount, extra quantity, better shipping, and/or free warranty) are given to the purchase orders. Also, the selection criteria can be any combination of widget type, zip code, and/or before a certain order date.</p>

<p>In sum, there are 16 possible combinations of freebies, and there are 8 possible combinations for the selection criteria. The full combination of cases adds up to 128 different cases (16 &times; 8). That is, if you decided not to use dynamic SQL you would need to write 128 different SQL updates to provide the same functionality this single dynamic SQL update offers. In cases like this one is where dynamic SQL shines.</p>

<p>Of course, it&#39;s not trivial to write the above dynamic SQL statement, but it&#39;s much less work than the alternative.</p>

<h3>A Few Notes on the Dynamic SQL Syntax</h3>

<p>Please note the CDATA section is needed for dynamic SQL. Otherwise the HotRod parser would try to interpret the dynamic tags as part of the HotRod configuration file.</p>

<p>In the CDATA section, some reserved XML characters found outside the tag definitions&mdash;i.e. in the SQL statement per se&mdash;must be escaped as an XML entity. That is:</p>

<ul>
  <li>any <code>&lt;</code> must be escaped as <code>&amp;lt;</code></li>
  <li>any <code>&gt;</code> character must be escaped as <code>&amp;gt;</code></li>
  <li>any <code>&amp;</code> character must be escaped as <code>&amp;amp;</code></li>
</ul>

<p>For example, the date comparison shows the character &lt; being escaped. Let me repeat this once more: the character escaping only affects the SQL code and not the dynamic tags themselves.</p>

<p>As in any non-dynamic SQL <code>&lt;query&gt;</code> tag the first time a parameter is used&mdash;regardless if it occurs inside a tag or in the SQL code&mdash;its full definition is required. All subsequent occurrences of the parameter use the simple form. For example, the first time the parameter <code>discount</code> is used it takes the full form:</p>

<pre>  #{discount,javaType=java.lang.Double,jdbcType=NUMERIC}</pre>

<p>Then, when used again it takes the simplified form:</p>

<pre>  #{discount}</pre>

<p>Finally, the dynamic SQL includes <code>&lt;set&gt;</code>, <code>&lt;if&gt;</code>, and <code>&lt;where&gt;</code> tags. These tags seem intuitive enough to use but they actually come with nice extras. If you re-read the example carefully, you may notice the commas that separate the set sections in the update are taken care of automatically by the <code>&lt;set&gt;</code> tag in all&mdash;I repeat ALL&mdash;parameter combinations. Also, the presence or absence of the <code>AND</code> SQL word is also managed automatically for you by the <code>&lt;where&gt;</code> tag. See the MyBatis manual for details on this.</p>

<p>&nbsp;</p>


      <!-- =========== -->
      <!-- Article End -->
      <!-- =========== -->

    </div>

  </div>

</body>
</html>