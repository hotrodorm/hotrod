<?xml version="1.0"?>
<!DOCTYPE empusa-mybatis SYSTEM "empusa-mybatis.dtd">

<empusa-mybatis>

  <layout>
    <daos gen-base-dir="gen/empusamb/daos" package="empusa.test.generation" />
    <mappers gen-base-dir="gen/empusamb/mappers" relative-dir="persistence" />
    <mybatis-configuration-template file="mybatis-config-template.xml" />
    <session-factory singleton-full-class-name="sessionfactory.DatabaseSessionFactory" />
    <select-generation temp-view-base-name="mybatis_temp_view" />
  </layout>

  <table name="account">
    <auto-generated-column name="id" />
  </table>

  <table name="transaction" package="accounting">
    <auto-generated-column name="seq_id"
      allows-specified-value="true" />

    <select method="getTransactionsForOldAccount">
      select t.*
        from transaction t
        join account a on (t.account_id) = (a.id)
        {*
        where a.created_on &lt; #{toDate,javaType=java.sql.Timestamp,jdbcType=TIMESTAMP}
        *}
    </select>

  </table>

  <dao name="AccountTransactionsDAO" package="accounting">

    <select method="getAccountsTransactionsForMaxAmount" result-class="CurrentTransactionsForMaxAmount">
      select a.* , t.*
        from transaction t
        join account a on (t.account_id) = (a.id)
        {*
        <if test="#{maxAmount,javaType=java.lang.Integer,jdbcType=NUMERIC} != null">
          and t.amount &lt;= #{maxAmount}
        </if>
        *}
    </select>

    <select method="getAccountTransactionInTimePeriod" result-class="CurrentTransactionsInTimePeriod">
      select a.* , t.*
        from transaction t
        join account a on (t.account_id) = (a.id)
        {*
        <where>
          <if test="#{from,javaType=java.sql.Timestamp,jdbcType=TIMESTAMP} != null">
            and t.time &gt; #{from}
          </if>
          <if test="#{to,javaType=java.sql.Timestamp,jdbcType=TIMESTAMP} != null">
            and t.time &lt; #{to}
          </if>
        </where>
        *}
    </select>

    <update method="deleteAccountTransactions">
      delete from transaction t
        where t.account_id = #{accountId,javaType=java.lang.Long,jdbcType=NUMERIC}
        <if test="#{pending,javaType=java.lang.Boolean,jdbcType=BOOLEAN} != null and #{pending}">
          and t.status = 'P'
        </if>
    </update>

  </dao>

  <include file="historic-transactions-daos.xml" />

</empusa-mybatis>

