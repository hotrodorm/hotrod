<dao-definition>

  <table name="log">
    <auto-generated-column name="id" />
  </table>

  <dao name="HistoricTransactionsDAO" package="historictxs">

    <select method="getHistoricTransactionsForMaxAmount"
      result-class="HistoricTransactionsForMaxAmount">
      select a.* , t.*
        from transaction t
        join account a on (t.account_id) = (a.id)
        {*
        <if test="#{maxAmount,javaType=java.lang.Integer,jdbcType=NUMERIC} != null">
          and t.amount &lt;= #{maxAmount}
        </if>
        *}
    </select>

    <select method="getHistoricTransactionInTimePeriod"
      result-class="HistoricTransactionInTimePeriod">
      select a.* , t.*
        from transaction t
        join account a on (t.account_id) = (a.id)
        {*
        <where>
          <if test="#{from,javaType=java.sql.Timestamp,jdbcType=TIMESTAMP} != null">
            and t.time &gt; #{from}
          </if>
          <if test="#{to,javaType=java.sql.Timestamp,jdbcType=TIMESTAMP} != null">
            and t.time &gt; #{to}
          </if>
        </where>
        *}
    </select>

    <update method="archiveAccountTransactions">
      update from transaction t
        set status = 'ARC'
        where t.account_id = #{accountId,javaType=java.lang.Long,jdbcType=NUMERIC}
        <if test="#{type,javaType=java.lang.String,jdbcType=VARCHAR} != null">
          and t.type = #{type}
        </if>
    </update>

  </dao>

</dao-definition>
