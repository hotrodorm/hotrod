<?xml version="1.0"?>
<!DOCTYPE hotrod-fragment>

<hotrod-fragment>

  <table name="brand" />

  <table name="car">
  
    <select method="findAssesedCarVO">

      <parameter name="brandId" java-type="java.lang.Integer" jdbc-type="NUMERIC" />

      select
      <columns>
        <vo table="car" alias="c" extended-vo="AssessedCarVO">
          <association table="brand" property="brand" alias="b" />
          <collection table="repair" property="repairs" alias="r" />
          <expressions>
            b.id * c.id + 71 as score,
            length(b.name) + length(c.type) as tier
          </expressions>
        </vo>
      </columns>
      from car c
      join brand b on b.id = c.brand_id
      left join repair r on r.car_id c.id
      <complement>
        <where>
        <if test="brandId != null">
          and b.type = #{brandId}
        </if>
        </where>
      </complement>

    </select>
    
  </table>

  <view name="van" />

  <table name="repair" />

</hotrod-fragment>
